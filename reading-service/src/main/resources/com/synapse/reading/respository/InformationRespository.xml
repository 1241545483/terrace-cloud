<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.synapse.reading.respository.InformationRespository">

    <!-- 通用查询映射结果 -->
    <resultMap id="com.synapse.reading.mapper.InformationMapper.BaseResultMap" type="com.synapse.reading.model.Information">
        <id column="is_liked" property="isLiked" />
    </resultMap>



    <update id="updateReadNum" parameterType="map">
        update  `information` SET
        `read_num`=`read_num`+1
        where
        `rec_id` = #{recId}
    </update>


    <update id="updateLikeAddNum" parameterType="map">
        update  `information` SET
        `like_num` = `like_num`+1
        where
            `rec_id` = #{recId}
    </update>

    <update id="updateLikeReduceNum" parameterType="map">
        update  `information` SET
        `like_num` = `like_num`-1
        where
        `rec_id` = #{recId}
    </update>

    <select id="listAddIsLike" parameterType="map" resultType="com.synapse.reading.mapper.InformationMapper.BaseResultMap" >
        select
        <include refid="com.synapse.reading.mapper.InformationMapper.Base_Column_List" />
        ,if(b.rec_id,true,false) is_liked
        from `information` a
        LEFT JOIN  my_like b ON a.rec_id = b.like_id
        AND b.create_id=#{userId} AND b.like_type="info"
        where 1 = 1
        <if test="recId != null" >
            AND `rec_id` = #{recId}
        </if>
        <if test="title != null" >
            AND `title` = #{title}
        </if>
        <if test="author != null" >
            AND `author` = #{author}
        </if>
        <if test="content != null" >
            AND `content` = #{content}
        </if>
        <if test="cover != null" >
            AND `cover` = #{cover}
        </if>
        <if test="readNum != null" >
            AND `read_num` = #{readNum}
        </if>
        <if test="likeNum != null" >
            AND `like_num` = #{likeNum}
        </if>
        <if test="publishStatus != null" >
            AND `publish_status` = #{publishStatus}
        </if>
        <if test="status != null" >
            AND `status` = #{status}
        </if>
        <if test="createId != null" >
            AND `create_id` = #{createId}
        </if>
        <if test="createTime != null" >
            AND `create_time` = #{createTime}
        </if>
        <if test="updateId != null" >
            AND `update_id` = #{updateId}
        </if>
        <if test="updateTime != null" >
            AND `update_time` = #{updateTime}
        </if>
        <if test="startIndex != null">
            limit ${startIndex}, ${pageSize}
        </if>
    </select>
</mapper>
